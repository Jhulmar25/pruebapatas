<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Credencial | Red de Patas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="credencial">
    <header>
      <h1>RED DE PATAS</h1>
      <p class="subtitulo">"San Isidro"</p>
      <img src="red-de-patas.jpg" alt="Logo Red de Patas" class="logo" />
    </header>

    <div class="contenido">
      <div class="foto">
        <img id="foto" src="https://via.placeholder.com/120x140" alt="Foto del Paseador" />
      </div>
      <div class="datos">
        <p><strong>NOMBRE:</strong> <span id="nombre">—</span></p>
        <p><strong>DNI:</strong> <span id="dni">—</span></p>
        <p><strong>CEL.:</strong> <span id="telefono">—</span></p>
      </div>
    </div>

    <footer>
      <p id="estado">Verificación digital — <a href="https://reddepatas.site">reddepatas.site</a></p>
    </footer>
  </div>

  <script>
    async function cargarCredencial() {
      const hash = window.location.hash.substring(1);
      if (!hash) {
        document.getElementById("estado").textContent = "⚠️ QR no válido o sin datos.";
        return;
      }

      // Extraer el código antes del primer '|'
      const codigo = hash.split("|")[0];
      const apiURL = `https://red-de-patas-api-812893065625.us-central1.run.app/api/verificar/${codigo}`;

      try {
        const resp = await fetch(apiURL);
        const data = await resp.json();

        if (data.ok) {
          document.getElementById("nombre").textContent = data.nombre;
          document.getElementById("dni").textContent = data.dni;
          document.getElementById("telefono").textContent = data.telefono;
          document.getElementById("foto").src = data.foto;
          document.getElementById("estado").textContent = "✅ Credencial verificada";
        } else {
          document.getElementById("estado").textContent = "❌ QR no registrado o falsificado";
        }
      } catch (err) {
        console.error(err);
        document.getElementById("estado").textContent = "⚠️ Error al verificar el QR";
      }
    }

    document.addEventListener("DOMContentLoaded", cargarCredencial);
  </script>
</body>
</html>
