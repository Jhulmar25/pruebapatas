<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Credencial | Red de Patas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="credencial">
    <header>
      
      
      <img src="logo.png" alt="Logo Red de Patas" class="logo" />
    </header>

    <div class="contenido">
      <div class="foto">
        <img id="foto" src="https://via.placeholder.com/120x140" alt="Foto del Paseador" />
      </div>
      <div class="datos">
        <p><strong>NOMBRE:</strong> <span id="nombre">—</span></p>
        <p><strong>DNI:</strong> <span id="dni">—</span></p>
        <p><strong>CEL.:</strong> <span id="telefono">—</span></p>
      </div>
    </div>

    <footer>
      <p id="estado">Verificación digital — <a href="https://reddepatas.site">reddepatas.site</a></p>
    </footer>
  </div>

  <script>
    async function cargarCredencial() {
      const hash = window.location.hash.substring(1);
      const estado = document.getElementById("estado");

      if (!hash) {
        estado.textContent = "⚠️ QR no válido o sin datos.";
        return;
      }

      const codigo = hash.split("|")[0];
      const apiURL = `https://red-de-patas-api-812893065625.us-central1.run.app/api/verificar/${codigo}`;
      console.log("Consultando:", apiURL);

      try {
        const resp = await fetch(apiURL);
        if (!resp.ok) {
          console.error("HTTP error:", resp.status);
          estado.textContent = "⚠️ Error al verificar el QR (HTTP " + resp.status + ")";
          return;
        }

        const data = await resp.json();
        console.log("Respuesta:", data);

        if (data.ok) {
          document.getElementById("nombre").textContent = data.nombre || "—";
          document.getElementById("dni").textContent = data.dni || "—";
          document.getElementById("telefono").textContent = data.telefono || "—";
          document.getElementById("foto").src = data.foto || "https://via.placeholder.com/120x140";
          estado.textContent = "✅ Credencial verificada";
        } else {
          estado.textContent = "❌ QR no registrado o falsificado";
        }
      } catch (err) {
        console.error("Error de red:", err);
        estado.textContent = "⚠️ Error al conectar con el servidor";
      }
    }

    document.addEventListener("DOMContentLoaded", cargarCredencial);
  </script>
</body>
</html>
